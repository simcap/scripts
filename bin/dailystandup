#!/usr/bin/env ruby

current_dir = ARGV[0] || '.'
git_author = `git config --get github.user`.chomp

today = Time.now.strftime '%F'

puts git_author 

subdirs = Dir.glob(File.join(current_dir, '**')).select {|f| File.directory? f}

git_repos = subdirs.inject([]) do |git_dirs, dir_path|
  Dir.chdir dir_path do 
    git_dir = File.join(Dir.pwd, '.git')
    git_dirs << git_dir if File.directory?(git_dir)
  end
  git_dirs
end

git_repos.each do |repo|
  Dir.chdir repo do
    puts File.basename(File.dirname(repo))
    puts `git log --since= --date=short --format='%an|%cn|%ad|%s' --author=#{git_author}`
  end  
end
